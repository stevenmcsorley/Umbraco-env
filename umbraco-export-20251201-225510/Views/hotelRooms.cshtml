@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    // Get layout from content property, ViewData, or default to Main
    var layoutFromContent = Model?.Value<string>("layout");
    var layoutName = !string.IsNullOrEmpty(layoutFromContent) ? layoutFromContent : ViewData["Layout"] as string;
    
    var layoutPath = layoutName switch
    {
        "HolyGrail" => "Layouts/HolyGrail.cshtml",
        "Sidebar" => "Layouts/Sidebar.cshtml",
        "Centered" => "Layouts/Centered.cshtml",
        "FullWidth" => "Layouts/FullWidth.cshtml",
        _ => "Layouts/Main.cshtml"
    };
    
    Layout = layoutPath;
    ViewData["Title"] = "Rooms & Suites";
    
    // Get hotel ID from route (can be slug or GUID)
    var hotelId = Context.Request.RouteValues["hotelSlug"]?.ToString() 
                  ?? Context.Request.RouteValues["hotelId"]?.ToString()
                  ?? ViewBag.HotelId as string 
                  ?? Model?.Key.ToString();
}

@{
    ViewData["HeroHeading"] = "Rooms & Suites";
    ViewData["HeroTagline"] = "Discover our exceptional accommodations";
    ViewData["HeroBackgroundColor"] = "bg-gray-900";
    ViewData["HeroTextColor"] = "text-white";
}
@await Html.PartialAsync("Partials/Hero", (object)null)

<section class="py-20 lg:py-28 bg-white">
    <div class="max-w-7xl mx-auto px-6 lg:px-12">
        <div id="rooms-container" class="space-y-16">
            <div class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
                <p class="text-gray-600 mt-4 text-lg font-light">Loading rooms...</p>
            </div>
        </div>
    </div>
</section>

<script>
    const hotelId = '@hotelId';
    
    Promise.all([
        fetch(`/api/hotels/${encodeURIComponent(hotelId)}`).then(r => {
            if (!r.ok) throw new Error(`Failed to fetch hotel: ${r.status}`);
            return r.json();
        }),
        fetch(`/api/hotels/${encodeURIComponent(hotelId)}/rooms`).then(r => {
            if (!r.ok) throw new Error(`Failed to fetch rooms: ${r.status}`);
            return r.json();
        })
    ])
    .then(([hotel, rooms]) => {
        const container = document.getElementById('rooms-container');
        const hotelSlug = hotel.slug || hotel.id;
        
        if (!rooms || rooms.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12">
                    <p class="text-gray-600 text-lg mb-4 font-light">No rooms available for this hotel.</p>
                    <a href="/hotels/${hotelSlug}" class="text-gray-900 hover:opacity-70 transition-opacity text-sm uppercase tracking-wide">← Back to Hotel</a>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        // Introduction
        html += `
            <div class="mb-16">
                <h2 class="text-4xl md:text-5xl font-serif text-gray-900 mb-4 tracking-tight">Rooms & Suites</h2>
                <p class="text-gray-600 text-lg font-light max-w-3xl">Experience unparalleled luxury in our thoughtfully designed accommodations, each offering unique character and exceptional comfort.</p>
            </div>
        `;
        
        // Rooms Grid - Single column, wide horizontal cards
        html += '<div style="display: flex; flex-direction: column; gap: 24px;">';
        
        rooms.forEach((room, index) => {
            const roomImageUrl = Array.isArray(room.heroImage) ? room.heroImage[0] : (room.heroImage || (Array.isArray(room.roomImages) && room.roomImages.length > 0 ? room.roomImages[0] : null));
            html += `
                <div style="display: flex; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; transition: box-shadow 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div style="width: 300px; min-width: 300px; aspect-ratio: 4/3; overflow: hidden; background: #f3f4f6; flex-shrink: 0;">
                        ${roomImageUrl ? `
                        <img src="${roomImageUrl}" alt="${room.name}" style="width: 100%; height: 100%; object-fit: cover;" />
                        ` : `
                        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); display: flex; align-items: center; justify-content: center;">
                            <span style="color: #9ca3af; font-size: 14px; font-weight: 300;">Room Image</span>
                        </div>
                        `}
                    </div>
                    <div style="padding: 24px; display: flex; flex-direction: column; gap: 12px; flex: 1;">
                        <h3 style="font-size: 22px; font-weight: 500; color: #111827; margin: 0; font-family: 'Playfair Display', serif; letter-spacing: -0.02em;">${room.name || 'Room'}</h3>
                        ${room.description ? `<p style="font-size: 14px; color: #6b7280; margin: 0; font-weight: 300; line-height: 1.6;">${room.description}</p>` : ''}
                        <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 4px;">
                            ${room.maxOccupancy ? `<span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 300;">${room.maxOccupancy} Guests</span>` : ''}
                            ${room.roomType ? `<span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 300;">${room.roomType}</span>` : ''}
                            ${room.size ? `<span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 300;">${room.size} m²</span>` : ''}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 12px;">
                            ${room.priceFrom ? `
                                <div>
                                    <p style="font-size: 11px; color: #9ca3af; margin: 0 0 4px 0; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 300;">From</p>
                                    <p style="font-size: 24px; font-weight: 500; color: #111827; margin: 0; font-family: 'Playfair Display', serif;">£${room.priceFrom}</p>
                                </div>
                            ` : '<div></div>'}
                            <a href="/hotels/${hotelSlug}/rooms/${room.slug || room.id}" style="padding: 10px 20px; font-size: 11px; font-weight: 300; background: #111827; color: #ffffff; border: none; border-radius: 4px; text-decoration: none; text-transform: uppercase; letter-spacing: 0.1em; transition: opacity 0.2s; white-space: nowrap;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'">
                                View Room
                            </a>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        
        container.innerHTML = html;
    })
    .catch(error => {
        console.error('Error loading rooms:', error);
        document.getElementById('rooms-container').innerHTML = `
            <div class="text-center py-12">
                <p class="text-red-600 mb-4">Error loading rooms. Please try again later.</p>
                <a href="/hotels/${hotelId}" class="text-gray-900 hover:opacity-70 transition-opacity text-sm uppercase tracking-wide">← Back to Hotel</a>
            </div>
        `;
    });
</script>

