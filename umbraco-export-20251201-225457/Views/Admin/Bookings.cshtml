@model List<MyDockerProject.Models.Booking>
@{
    Layout = "~/Views/Layouts/FullWidth.cshtml";
    ViewData["Title"] = "Bookings Management";
}

<div class="admin-bookings">
    <h1>Bookings Management</h1>
    
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-error">@TempData["Error"]</div>
    }

    <div class="filters">
        <form method="get" action="/admin/bookings">
            <input type="text" name="search" placeholder="Search by reference, email, name..." value="@Context.Request.Query["search"]" />
            <select name="status">
                <option value="">All Statuses</option>
                <option value="Confirmed" selected="@(Context.Request.Query["status"] == "Confirmed")">Confirmed</option>
                <option value="Cancelled" selected="@(Context.Request.Query["status"] == "Cancelled")">Cancelled</option>
                <option value="Completed" selected="@(Context.Request.Query["status"] == "Completed")">Completed</option>
            </select>
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="/admin/bookings" class="btn btn-secondary">Clear</a>
        </form>
    </div>

    <table class="bookings-table">
        <thead>
            <tr>
                <th>Reference</th>
                <th>Guest</th>
                <th>Product</th>
                <th>Dates</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Status</th>
                <th>Payment</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var booking in Model)
            {
                <tr>
                    <td><strong>@booking.BookingReference</strong></td>
                    <td>
                        @booking.GuestFirstName @booking.GuestLastName<br/>
                        <small>@booking.GuestEmail</small><br/>
                        @if (!string.IsNullOrEmpty(booking.GuestPhone))
                        {
                            <small>@booking.GuestPhone</small>
                        }
                    </td>
                    <td>@booking.ProductType<br/><small>@booking.ProductId</small></td>
                    <td>
                        @booking.CheckIn.ToString("dd MMM yyyy")<br/>
                        @if (booking.CheckOut.HasValue)
                        {
                            <small>to @booking.CheckOut.Value.ToString("dd MMM yyyy")</small>
                        }
                    </td>
                    <td>@booking.Quantity</td>
                    <td><strong>@booking.Currency @booking.TotalPrice.ToString("N2")</strong></td>
                    <td>
                        <span class="status-badge status-@booking.Status.ToLower()">@booking.Status</span>
                    </td>
                    <td>
                        @if (!string.IsNullOrEmpty(booking.PaymentStatus))
                        {
                            <span class="status-badge status-@booking.PaymentStatus.ToLower()">@booking.PaymentStatus</span><br/>
                            @if (!string.IsNullOrEmpty(booking.PaymentId))
                            {
                                <small>ID: @booking.PaymentId</small>
                            }
                        }
                        else
                        {
                            <span class="status-badge status-pending">Pending</span>
                        }
                    </td>
                    <td>@booking.CreatedAt.ToString("dd MMM yyyy HH:mm")</td>
                    <td>
                        <a href="/api/bookings/@booking.BookingReference" target="_blank" class="btn btn-sm">View API</a>
                        @if (booking.Status != "Cancelled")
                        {
                            <form method="post" action="/admin/bookings/@booking.BookingReference/cancel" style="display:inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Cancel booking @booking.BookingReference?')">Cancel</button>
                            </form>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<style>
.admin-bookings {
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
}

.filters {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 2rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.filters form {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.filters input[type="text"],
.filters select {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    flex: 1;
}

.alert {
    padding: 1rem;
    border-radius: 4px;
    margin: 1rem 0;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.bookings-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-top: 1rem;
}

.bookings-table th {
    background: #f5f5f5;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #ddd;
}

.bookings-table td {
    padding: 1rem;
    border-bottom: 1px solid #eee;
    vertical-align: top;
}

.bookings-table tr:hover {
    background: #f9f9f9;
}

.status-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
}

.status-confirmed {
    background: #d4edda;
    color: #155724;
}

.status-cancelled {
    background: #f8d7da;
    color: #721c24;
}

.status-paid {
    background: #d1ecf1;
    color: #0c5460;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: background 0.2s;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.85rem;
    margin: 0.25rem 0;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}
</style>

