@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@using Umbraco.Cms.Core.Models.PublishedContent
@{
    // Choose layout: Main, HolyGrail, Sidebar, Centered, FullWidth
    Layout = ViewData["Layout"] as string ?? "Layouts/Main.cshtml";
    ViewData["Title"] = Model?.Name ?? "Hotel Details";
    ViewData["SiteName"] = "Hotel Booking Site";
    
    // Get hotel ID from Model (Umbraco) or route/ViewBag (custom route)
    var hotelId = Model?.Key.ToString() ?? ViewBag.HotelId as string ?? Context.Request.RouteValues["id"]?.ToString();
}

<div id="hotel-page-content">
    <div class="text-center py-12">
        <p class="text-gray-600">Loading hotel details...</p>
    </div>
</div>

<script>
    const hotelId = '@hotelId';
    
    Promise.all([
        fetch(`/api/hotels/${hotelId}`).then(r => r.json()),
        fetch(`/api/hotels/${hotelId}/rooms`).then(r => r.json()),
        fetch(`/api/hotels/${hotelId}/offers`).then(r => r.json())
    ])
    .then(([hotel, rooms, offers]) => {
        const container = document.getElementById('hotel-page-content');
        
        // Build page using Site Kit components via JavaScript
        let html = '';
        
        // Hero Section
        html += `
            <div class="bg-blue-900 text-white py-20">
                <div class="container mx-auto px-4 text-center">
                    <h1 class="text-5xl font-bold mb-4">${hotel.name || 'Hotel'}</h1>
                    ${hotel.description ? `<p class="text-xl opacity-90 mb-6">${hotel.description}</p>` : ''}
                    ${hotel.address ? `
                        <div class="text-gray-300 text-sm">
                            <p>üìç ${hotel.address}</p>
                            ${hotel.city ? `<p>${hotel.city}${hotel.country ? ', ' + hotel.country : ''}</p>` : ''}
                            ${hotel.phone ? `<p>üìû ${hotel.phone}</p>` : ''}
                            ${hotel.email ? `<p>‚úâÔ∏è ${hotel.email}</p>` : ''}
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
        
        // Features Section (if hotel has features)
        if (hotel.address || hotel.phone || hotel.email) {
            html += `
                <section class="py-12">
                    <div class="container mx-auto px-4">
                        <h2 class="text-3xl font-bold mb-8 text-center">Hotel Information</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            ${hotel.address ? `
                                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                                    <div class="text-4xl mb-4">üìç</div>
                                    <h3 class="text-xl font-bold mb-2">Location</h3>
                                    <p class="text-gray-600">${hotel.address}</p>
                                    ${hotel.city ? `<p class="text-gray-600">${hotel.city}${hotel.country ? ', ' + hotel.country : ''}</p>` : ''}
                                </div>
                            ` : ''}
                            ${hotel.phone ? `
                                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                                    <div class="text-4xl mb-4">üìû</div>
                                    <h3 class="text-xl font-bold mb-2">Contact</h3>
                                    <p class="text-gray-600">${hotel.phone}</p>
                                    ${hotel.email ? `<p class="text-gray-600">${hotel.email}</p>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </section>
            `;
        }
        
        // Offers Section
        if (offers && offers.length > 0) {
            html += `
                <section class="py-12 bg-gray-50">
                    <div class="container mx-auto px-4">
                        <h2 class="text-3xl font-bold mb-8 text-center">Special Offers</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${offers.map(offer => `
                                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold mb-2">${offer.name || 'Offer'}</h3>
                                        ${offer.description ? `<p class="text-gray-600 mb-4">${offer.description}</p>` : ''}
                                        ${offer.discount ? `<p class="text-3xl font-bold text-green-600 mb-2">${offer.discount}% Off</p>` : ''}
                                        ${offer.validFrom && offer.validTo ? `
                                            <p class="text-sm text-gray-500">Valid: ${new Date(offer.validFrom).toLocaleDateString()} - ${new Date(offer.validTo).toLocaleDateString()}</p>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }
        
        // Rooms Section
        if (rooms && rooms.length > 0) {
            html += `
                <section class="py-12">
                    <div class="container mx-auto px-4">
                        <h2 class="text-3xl font-bold mb-8 text-center">Our Rooms</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${rooms.map(room => `
                                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold mb-2">${room.name || 'Room'}</h3>
                                        ${room.description ? `<p class="text-gray-600 mb-4 line-clamp-3">${room.description}</p>` : ''}
                                        <div class="flex justify-between items-center mb-4">
                                            ${room.priceFrom ? `<p class="text-2xl font-bold text-blue-600">¬£${room.priceFrom} <span class="text-sm text-gray-500">per night</span></p>` : ''}
                                            ${room.maxOccupancy ? `<p class="text-sm text-gray-500">Max ${room.maxOccupancy} guests</p>` : ''}
                                        </div>
                                        <a href="/hotels/${hotelId}/rooms/${room.id}" class="inline-block w-full text-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                                            Book Now
                                        </a>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </section>
            `;
        }
        
        container.innerHTML = html;
    })
    .catch(error => {
        console.error('Error loading hotel:', error);
        document.getElementById('hotel-page-content').innerHTML = `
            <div class="text-center py-12">
                <h1 class="text-3xl font-bold mb-4">Hotel Not Found</h1>
                <a href="/hotels" class="text-blue-600 hover:underline">‚Üê Back to Hotels</a>
            </div>
        `;
    });
</script>
